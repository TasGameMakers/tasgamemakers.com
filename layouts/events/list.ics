BEGIN:VCALENDAR{{ "\r\n" -}}
VERSION:2.0{{ "\r\n" -}}
PRODID:-//Tas Game Makers//Events//EN{{ "\r\n" -}}
CALSCALE:GREGORIAN{{ "\r\n" -}}
METHOD:PUBLISH{{ "\r\n" -}}
X-WR-CALNAME:Tas Game Makers Events{{ "\r\n" -}}
X-WR-TIMEZONE:Australia/Hobart{{ "\r\n" -}}
REFRESH-INTERVAL;VALUE=DURATION:PT1H{{ "\r\n" -}}
X-PUBLISHED-TTL:PT1H{{ "\r\n" -}}
{{ range where .Pages ".Params.unlisted" "ne" true -}}
{{- $title := printf "Tas Game Makers: %s" .Title -}}
{{- $title = replace $title "\\" "\\\\" -}}
{{- $title = replace $title ";" "\\;" -}}
{{- $title = replace $title "," "\\," -}}
{{- $title = replace $title "\r" "" -}}
{{- $title = replace $title "\n" "\\n" -}}
{{- $desc := .Params.summary | default .Title -}}
{{- $desc = replace $desc "\\" "\\\\" -}}
{{- $desc = replace $desc ";" "\\;" -}}
{{- $desc = replace $desc "," "\\," -}}
{{- $desc = replace $desc "\r" "" -}}
{{- $desc = replace $desc "\n" "\\n" -}}
{{- $loc := "" -}}
{{- with .Params.location -}}
{{- $loc = replace . "\\" "\\\\" -}}
{{- $loc = replace $loc ";" "\\;" -}}
{{- $loc = replace $loc "," "\\," -}}
{{- $loc = replace $loc "\r" "" -}}
{{- $loc = replace $loc "\n" "\\n" -}}
{{- end -}}
{{- if .Params.event_days -}}
{{- range $i, $day := .Params.event_days -}}
{{- $dayStart := time $day.start -}}
{{- $dayEnd := time $day.end -}}
BEGIN:VEVENT{{ "\r\n" -}}
UID:{{ $.Permalink }}day{{ $i }}{{ "\r\n" -}}
DTSTAMP:{{ now.UTC.Format "20060102T150405Z" }}{{ "\r\n" -}}
DTSTART:{{ $dayStart.UTC.Format "20060102T150405Z" }}{{ "\r\n" -}}
DTEND:{{ $dayEnd.UTC.Format "20060102T150405Z" }}{{ "\r\n" -}}
SUMMARY:{{ $title }} (Day {{ add $i 1 }}){{ "\r\n" -}}
DESCRIPTION:{{ $desc }}{{ "\r\n" -}}
{{ if $loc -}}LOCATION:{{ $loc }}{{ "\r\n" -}}{{ end -}}
URL:{{ $.Permalink }}{{ "\r\n" -}}
STATUS:CONFIRMED{{ "\r\n" -}}
END:VEVENT{{ "\r\n" -}}
{{- end -}}
{{- else -}}
BEGIN:VEVENT{{ "\r\n" -}}
UID:{{ .Permalink }}{{ "\r\n" -}}
DTSTAMP:{{ now.UTC.Format "20060102T150405Z" }}{{ "\r\n" -}}
{{- if .Params.event_allday -}}
DTSTART;VALUE=DATE:{{ .Date.UTC.Format "20060102" }}{{ "\r\n" -}}
DTEND;VALUE=DATE:{{ (time .Params.end_date).UTC.Format "20060102" }}{{ "\r\n" -}}
X-MICROSOFT-CDO-ALLDAYEVENT: TRUE{{ "\r\n" -}}
{{- else -}}
DTSTART:{{ .Date.UTC.Format "20060102T150405Z" }}{{ "\r\n" -}}
{{ with .Params.end_date -}}
DTEND:{{ (time .).UTC.Format "20060102T150405Z" }}{{ "\r\n" -}}
{{ end -}}
{{ end -}}
SUMMARY:{{ $title }}{{ "\r\n" -}}
DESCRIPTION:{{ $desc }}{{ "\r\n" -}}
{{ if $loc -}}LOCATION:{{ $loc }}{{ "\r\n" -}}{{ end -}}
URL:{{ .Permalink }}{{ "\r\n" -}}
STATUS:CONFIRMED{{ "\r\n" -}}
END:VEVENT{{ "\r\n" -}}
{{- end -}}
{{ end -}}
END:VCALENDAR{{ "\r\n" -}}
